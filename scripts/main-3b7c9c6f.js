(function(){function t(t,e){for(var n=-1,r=e.length>>>0;++n<r;)if(t===e[n])return!0;return!1}YASR.plugins.gmaps=function(e){var n;return n=e.container.closest("[id]").attr("id"),{yasr:e,name:"Google Maps",hideFromSelection:!1,priority:1,canHandleResults:function(e){return e.results&&e.results.getVariables&&e.results.getVariables()&&t("lat",e.results.getVariables())&&t("lon",e.results.getVariables())},draw:function(){function t(t){google.maps.event.addListener(t.marker,"click",function(){var e,n,a,i;e="<table>";for(n in a=t.res)i=a[n],e+="<tr><th>"+n+"</th><td>"+i.value+"</td></tr>";e+="</table>",o.setContent(e),o.open(r,t.marker)})}var n,r,a,o,i,s,l,p,u;for(e.resultsContainer.html('<div id="gmap"></div>'),n={mapTypeId:google.maps.MapTypeId.SATELLITE},r=new google.maps.Map(e.resultsContainer.find("div")[0],n),a=new google.maps.LatLngBounds,o=new google.maps.InfoWindow,i=0,l=(s=e.results.getBindings()).length;l>i;++i)p=s[i],u=new google.maps.LatLng(p.lat.value,p.lon.value),a.extend(u),t.call(this,{res:p,marker:new google.maps.Marker({position:u,map:r,title:null!=p.name?p.name.value:p.lat.value+","+p.lon.value})});r.fitBounds(a),r.panToBounds(a)}}}}).call(this),function(){function t(t,e){for(var n=-1,r=e.length>>>0;++n<r;)if(t===e[n])return!0;return!1}YASR.plugins.kml=function(e){var n;return n=e.container.closest("[id]").attr("id"),{yasr:e,name:"KML",hideFromSelection:!1,priority:1,canHandleResults:function(e){return e.results&&e.results.getVariables&&e.results.getVariables()&&t("coordinates",e.results.getVariables())},draw:function(){var t,n,r;t=e.yasqe.getOption("sparql").endpoint,n=e.yasqe.getValue(),r="http://demo.seco.tkk.fi/sparql2kml/?endpoint="+encodeURIComponent(t)+"&query="+encodeURIComponent(n),e.resultsContainer.html('<button id="kml-copy" class="yasr_btn" style="float:right;position:relative; top:-30px;margin-bottom:-30px">Copy</button><div>URL for KML file: <a href="" id="kml-url"></a> (<a id="kml-e4d" href="" target="_blank">in Europeana 4D</a>)</div>'),$("#kml-url").text(r).attr("href",r),$("#kml-e4d").attr("href","http://www.informatik.uni-leipzig.de:8080/e4D/?source1=1&kml1="+encodeURIComponent(r)),$("#kml-copy").click(function(){window.prompt("Copy to clipboard with Ctrl/Cmd-C",r)}),$.ajax("https://www.googleapis.com/urlshortener/v1/url?key=AIzaSyDtS96pmj2IeRdw81zobVDpCfs0rFphHvc",{data:JSON.stringify({longUrl:r}),contentType:"application/json",type:"POST"}).success(function(t){r=t.id,$("#kml-url").text(r).attr("href",r),$("#kml-e4d").attr("href","http://www.informatik.uni-leipzig.de:8080/e4D/?source1=1&kml1="+encodeURIComponent(r))})}}}}.call(this),function(){"use strict";angular.module("app",["ui.router","ngStorage"]).config(["$stateProvider","$urlRouterProvider",function(t,e){return t.state("home",{url:"/?sparqlEndpoint&query&outputType",templateUrl:"partials/main.html",controller:"MainCtrl"}),e.otherwise("/")}])}.call(this),function(){"use strict";angular.module("app").controller("MainCtrl",["$window","$location","$http","$scope","$localStorage","$state","$stateParams","$q",function(t,e,n,r,a,o,i,s){var l,p,u,d,c,g;null!=i.sparqlEndpoint&&(a.sparqlEndpoint=i.sparqlEndpoint),null!=a.sparqlEndpoint&&(r.sparqlEndpoint=a.sparqlEndpoint),r.shareLink=function(){var a,o,i,s;e.search("sparqlEndpoint",r.sparqlEndpoint),e.search("query",l.getValue()),e.search("outputType",u.options.output);for(a in o=u.plugins)i=o[a],null!=i.getPersistentSettings&&e.search(a,JSON.stringify(i.getPersistentSettings()));s=e.absUrl(),r.shareLinkLoading=!0,n.post("https://www.googleapis.com/urlshortener/v1/url?key=AIzaSyDtS96pmj2IeRdw81zobVDpCfs0rFphHvc",{longUrl:s}).then(function(e){r.shareLinkLoading=!1,t.prompt("Copy to clipboard with Ctrl/Cmd-C",e.data.id)},function(){r.shareLinkLoading=!1,t.alert("URL updated, copy it from the browser address bar")})},l=YASQE(document.getElementById("yasqe"),{createShareLink:!1,sparql:{showQueryButton:!0,endpoint:r.sparqlEndpoint,query:""}}),null!=i.query&&l.setValue(i.query),r.sparqlEndpointInputValid=!0,p=void 0,r.$watch("sparqlEndpoint",function(t,e){null!=t&&(null!=p&&p.resolve(),p=s.defer(),n({method:"GET",url:t,params:{query:"ASK {}"},headers:{Accept:"application/sparql-results+json"},timeout:p.promise}).success(function(t){r.sparqlEndpointInputValid=null!=t["boolean"]}).error(function(){r.sparqlEndpointInputValid=!1})),t!==e&&(a.sparqlEndpoint=t,l.getOption("sparql").endpoint=t)}),u=YASR(document.getElementById("yasr"),{persistency:{outputSelector:i.outputType?!1:"visu",results:!1},getUsedPrefixes:l.getPrefixesFromQuery,output:null!=(d=i.outputType)?d:void 0,gchart:{chartConfig:i.chartConfig,motionChartState:i.motionChartState}}),null!=e.search().chartConfig&&(e.search("gchart",JSON.stringify({chartConfig:JSON.parse(e.search().chartConfig),motionChartState:e.search().motionChartState?JSON.parse(e.search().motionChartState):void 0})),e.search("chartConfig",void 0));for(c in d=u.plugins)g=d[c],null!=g.setPersistentSettings&&e.search()[c]&&g.setPersistentSettings(JSON.parse(e.search()[c]));return u.yasqe=l,u.options.persistency.outputSelector="visu",l.options.sparql.handlers.success=function(t,e,n){return u.setResponse({response:t,contentType:n.getResponseHeader("Content-Type")})},l.options.sparql.handlers.error=function(t,e,n){var r;return r=e+" (response status code "+t.status+")",n&&n.length&&(r+=": "+n),u.setResponse({exception:r})},null!=i.sparqlEndpoint&&null!=i.query?l.query():void 0}])}.call(this),function(t){try{t=angular.module("app")}catch(e){t=angular.module("app",[])}t.run(["$templateCache",function(t){t.put("partials/main.html",'\n<div class="ui page grid">\n  <div class="column">\n    <h1 class="ui header center aligned">(Visual) SPARQL query tool</h1>\n    <div id="shareicondiv"><i id="shareicon" ng-click="shareLink()" ng-class="shareLinkLoading ? \'loading\' : \'share\'" class="icon"></i></div>\n    <div class="ui form">\n      <div ng-class="{ \'error\': !sparqlEndpointInputValid }" class="field">\n        <label>SPARQL endpoint</label>\n        <input ng-model="sparqlEndpoint" type="text"/>\n      </div>\n      <div id="yasqe"></div>\n    </div>\n    <div id="yasr"></div>\n  </div>\n</div>')}])}();