(function(){"use strict";angular.module("app",["ui.router","ngStorage","ngRoute","ngAnimate","ngSanitize","raw.services","raw.directives","raw.controllers","mgcrea.ngStrap","ui","colorpicker.module"]).config(["$stateProvider","$urlRouterProvider",function(t,n){return t.state("home",{url:"/?sparqlEndpoint&query&outputType",templateUrl:"partials/main.html",controller:"MainCtrl"}),n.otherwise("/")}])}).call(this),function(){angular.module("app").filter("to_trusted",["$sce",function(t){return function(n){return t.trustAsHtml(n)}}]),angular.module("app").run(["$compile","$rootScope",function(t,n){YASR.plugins.raw=function(e){return{yasr:e,name:"RAW",hideFromSelection:!1,priority:1,scope:void 0,settings:void 0,setPersistentSettings:function(t){this.settings=t},getPersistentSettings:function(){var t,n,e,s,i,a,o,l,r;for(t=-1,n=0,s=(e=this.scope.charts).length;s>n;++n)i=n,a=e[n],this.scope.chart===a&&(t=i);this.settings={chartIndex:t,dimensions:{},options:[]};for(o in e=this.scope.model.dimensions()._)l=e[o],this.settings.dimensions[o]=l();if(-1!==t)for(n=0,s=(e=this.scope.charts[t].options()).length;s>n;++n)r=e[n],this.settings.options.push("function"!=typeof r()?r():void 0);return console.log(this.settings),this.settings},canHandleResults:function(t){return t.results&&t.results.getVariables&&t.results.getVariables()},draw:function(){var s;s=n.$new(),s.lastError=0,s.text=e.plugins.table.getDownloadInfo().getContent().replace(/^ /gm,"").replace(/ ,$/gm,"").replace(/ , /g,",").replace(/"/g,""),e.resultsContainer.html(t('<div ng-controller="RawCtrl"><div ng-include=\'"partials/raw.html"\'></div></div>')(s)),s.$digest(),this.scope=s.$$childHead,this.scope.parse(s.text),null!=this.settings&&(-1!==this.settings.chartIndex&&(this.scope.chart=this.scope.charts[this.settings.chartIndex],this.scope.model.clear(),this.scope.model=this.scope.chart.model()),this.scope.$digest(),this.settings=void 0),window.ts=this.scope}}}}])}.call(this),function(){function t(t,n){for(var e=-1,s=n.length>>>0;++e<s;)if(t===n[e])return!0;return!1}YASR.plugins.gmaps=function(n){return{yasr:n,name:"Google Maps",hideFromSelection:!1,priority:2,canHandleResults:function(n){return n.results&&n.results.getVariables&&n.results.getVariables()&&t("lat",n.results.getVariables())&&t("lon",n.results.getVariables())},draw:function(){function t(t){google.maps.event.addListener(t.marker,"click",function(){var n,e,i,o;n="<table>";for(e in i=t.res)o=i[e],n+="<tr><th>"+e+"</th><td>"+o.value+"</td></tr>";n+="</table>",a.setContent(n),a.open(s,t.marker)})}var e,s,i,a,o,l,r,c,d;for(n.resultsContainer.html('<div id="gmap"></div>'),e={mapTypeId:google.maps.MapTypeId.SATELLITE},s=new google.maps.Map(n.resultsContainer.find("div")[0],e),i=new google.maps.LatLngBounds,a=new google.maps.InfoWindow,o=0,r=(l=n.results.getBindings()).length;r>o;++o)c=l[o],d=new google.maps.LatLng(c.lat.value,c.lon.value),i.extend(d),t.call(this,{res:c,marker:new google.maps.Marker({position:d,map:s,title:null!=c.name?c.name.value:c.lat.value+","+c.lon.value})});s.fitBounds(i),s.panToBounds(i)}}}}.call(this),function(){function t(t,n){for(var e=-1,s=n.length>>>0;++e<s;)if(t===n[e])return!0;return!1}YASR.plugins.kml=function(n){return{yasr:n,name:"KML",hideFromSelection:!1,priority:3,canHandleResults:function(n){return n.results&&n.results.getVariables&&n.results.getVariables()&&t("coordinates",n.results.getVariables())},draw:function(){var t,e,s;t=n.yasqe.getOption("sparql").endpoint,e=n.yasqe.getValue(),s="http://demo.seco.tkk.fi/sparql2kml/?endpoint="+encodeURIComponent(t)+"&query="+encodeURIComponent(e),n.resultsContainer.html('<button id="kml-copy" class="yasr_btn" style="float:right;position:relative; top:-30px;margin-bottom:-30px">Copy</button><div>URL for KML file: <a href="" id="kml-url"></a> (<a id="kml-e4d" href="" target="_blank">in Europeana 4D</a>)</div>'),$("#kml-url").text(s).attr("href",s),$("#kml-e4d").attr("href","http://www.informatik.uni-leipzig.de:8080/e4D/?source1=1&kml1="+encodeURIComponent(s)),$("#kml-copy").click(function(){window.prompt("Copy to clipboard with Ctrl/Cmd-C",s)}),$.ajax("https://www.googleapis.com/urlshortener/v1/url?key=AIzaSyDtS96pmj2IeRdw81zobVDpCfs0rFphHvc",{data:JSON.stringify({longUrl:s}),contentType:"application/json",type:"POST"}).success(function(t){s=t.id,$("#kml-url").text(s).attr("href",s),$("#kml-e4d").attr("href","http://www.informatik.uni-leipzig.de:8080/e4D/?source1=1&kml1="+encodeURIComponent(s))})}}}}.call(this),function(){angular.module("app").controller("MainCtrl",["$window","$location","$http","$scope","$localStorage","$state","$stateParams","$q",function(t,n,e,s,i,a,o,l){var r,c,d,p,u,g;null!=o.sparqlEndpoint&&(i.sparqlEndpoint=o.sparqlEndpoint),null!=i.sparqlEndpoint&&(s.sparqlEndpoint=i.sparqlEndpoint),s.shareLink=function(){var i,a,o,l;n.search("sparqlEndpoint",s.sparqlEndpoint),n.search("query",r.getValue()),n.search("outputType",d.options.output);for(i in a=d.plugins)o=a[i],null!=o.getPersistentSettings&&n.search(i,JSON.stringify(o.getPersistentSettings()));l=n.absUrl(),s.shareLinkLoading=!0,e.post("https://www.googleapis.com/urlshortener/v1/url?key=AIzaSyDtS96pmj2IeRdw81zobVDpCfs0rFphHvc",{longUrl:l}).then(function(n){s.shareLinkLoading=!1,t.prompt("Copy to clipboard with Ctrl/Cmd-C",n.data.id)},function(){s.shareLinkLoading=!1,t.alert("URL updated, copy it from the browser address bar")})},r=YASQE(document.getElementById("yasqe"),{createShareLink:!1,sparql:{showQueryButton:!0,endpoint:s.sparqlEndpoint,query:""}}),null!=o.query&&r.setValue(o.query),s.sparqlEndpointInputValid=!0,c=void 0,s.$watch("sparqlEndpoint",function(t,n){null!=t&&(null!=c&&c.resolve(),c=l.defer(),e({method:"GET",url:t,params:{query:"ASK {}"},headers:{Accept:"application/sparql-results+json"},timeout:c.promise}).success(function(t){s.sparqlEndpointInputValid=null!=t["boolean"]}).error(function(){s.sparqlEndpointInputValid=!1})),t!==n&&(i.sparqlEndpoint=t,r.getOption("sparql").endpoint=t)}),d=YASR(document.getElementById("yasr"),{persistency:{outputSelector:o.outputType?!1:"visu",results:!1},getUsedPrefixes:r.getPrefixesFromQuery}),null!=o.outputType&&(d.options.output=o.outputType,d.header.find("button.selected").removeClass("selected"),d.header.find("button.select_"+o.outputType).addClass("selected")),null!=n.search().chartConfig&&(n.search("gchart",JSON.stringify({chartConfig:JSON.parse(n.search().chartConfig),motionChartState:n.search().motionChartState?n.search().motionChartState:void 0})),n.search("chartConfig",void 0),n.search("motionChartState",void 0));for(p in u=d.plugins)g=u[p],null!=g.setPersistentSettings&&n.search()[p]&&g.setPersistentSettings(JSON.parse(n.search()[p]));return d.yasqe=r,d.options.persistency.outputSelector="visu",r.options.sparql.handlers.success=function(t,n,e){return d.setResponse({response:t,contentType:e.getResponseHeader("Content-Type")})},r.options.sparql.handlers.error=function(t,n,e){var s;return s=n+" (response status code "+t.status+")",e&&e.length&&(s+=": "+e),d.setResponse({exception:s})},null!=o.sparqlEndpoint&&null!=o.query?r.query():void 0}])}.call(this),function(t){try{t=angular.module("app")}catch(n){t=angular.module("app",[])}t.run(["$templateCache",function(t){t.put("partials/colors.html",'\n<script type="text/ng-template" id="templates/colors.html">\n  <button type="button" ng-model="colorScale" ng-change="setScale()" ng-options="scale.type for scale in scales" bs-select="" class="btn btn-default">Action<span class="caret"></span></button>\n  <div class="colors-table">\n    <div ng-show="colors.length">\n      <input ng-model="searchColor" type="text" placeholder="Search..." class="search-color form-control input-sm"/><i data-ng-show="searchColor" ng-click="searchColor=\'\'" class="fa fa-times-circle search-clear"></i>\n    </div>\n    <table class="table table-striped">\n      <tbody>\n        <tr ng-repeat="color in colors | filter:{\'key\':searchColor} track by $index">\n          <td>\n            <p class="light small sample-name">{{color.key}}</p>\n          </td>\n          <td class="sample">\n            <input type="text" colorpicker="hex" data-color="#ff0" data-ng-style="{\'background-color\' : color.value, \'color\' : foreground(color.value)}" ng-model="color.value" ng-change="setColor(color.key,color.value)" class="sample-color form-control"/>\n            <div class="clearfix"></div>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n  </div>\n</script>')}])}(),function(t){try{t=angular.module("app")}catch(n){t=angular.module("app",[])}t.run(["$templateCache",function(t){t.put("partials/dimensions.html",'\n<script type="text/ng-template" id="templates/dimensions.html">\n  <ul class="list-unstyled dimensions-list">{{metadata}}\n    <li data-index="{{$index}}" data-dimension="{{dimension}}" ng-repeat="dimension in metadata" class="dimension">{{ dimension.key }}<span class="dimension-type">{{dimension.type}}</span><span class="dimension-icon pull-right"><i class="fa fa-bars"></i></span></li>\n  </ul>\n</script>')}])}(),function(t){try{t=angular.module("app")}catch(n){t=angular.module("app",[])}t.run(["$templateCache",function(t){t.put("partials/main.html",'\n<div class="ui page grid">\n  <div class="column">\n    <h1 class="ui header center aligned">(Visual) SPARQL query tool</h1>\n    <div id="shareicondiv"><i id="shareicon" ng-click="shareLink()" ng-class="shareLinkLoading ? \'loading\' : \'share\'" class="icon"></i></div>\n    <div class="ui form">\n      <div ng-class="{ \'error\': !sparqlEndpointInputValid }" class="field">\n        <label>SPARQL endpoint</label>\n        <input ng-model="sparqlEndpoint" type="text"/>\n      </div>\n      <div id="yasqe"></div>\n    </div>\n    <div id="yasr"></div>\n  </div>\n</div>')}])}(),function(t){try{t=angular.module("app")}catch(n){t=angular.module("app",[])}t.run(["$templateCache",function(t){t.put("partials/raw.html",'\n<div>\n  <script type="text/ng-template" id="templates/colors.html">\n    <button type="button" ng-model="colorScale" ng-change="setScale()" ng-options="scale.type for scale in scales" bs-select="" class="btn btn-default">Action<span class="caret"></span></button>\n    <div class="colors-table">\n      <div ng-show="colors.length">\n        <input ng-model="searchColor" type="text" placeholder="Search..." class="search-color form-control input-sm"/><i data-ng-show="searchColor" ng-click="searchColor=\'\'" class="fa fa-times-circle search-clear"></i>\n      </div>\n      <table class="table table-striped">\n        <tbody>\n          <tr ng-repeat="color in colors | filter:{\'key\':searchColor} track by $index">\n            <td>\n              <p class="light small sample-name">{{color.key}}</p>\n            </td>\n            <td class="sample">\n              <input type="text" colorpicker="hex" data-color="#ff0" data-ng-style="{\'background-color\' : color.value, \'color\' : foreground(color.value)}" ng-model="color.value" ng-change="setColor(color.key,color.value)" class="sample-color form-control"/>\n              <div class="clearfix"></div>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </script>\n  <script type="text/ng-template" id="templates/dimensions.html">\n    <ul class="list-unstyled dimensions-list">{{metadata}}\n      <li data-index="{{$index}}" data-dimension="{{dimension}}" ng-repeat="dimension in metadata" class="dimension">{{ dimension.key }}<span class="dimension-type">{{dimension.type}}</span><span class="dimension-icon pull-right"><i class="fa fa-bars"></i></span></li>\n    </ul>\n  </script>\n  <section data-ng-show="!error &amp;&amp; data.length">\n    <h3 id="layout">Choose a Chart</h3>\n    <div class="row">\n      <div class="col-lg-3 col-md-3">\n        <div class="chart-description">\n          <h4>{{chart.title()}}</h4>\n          <hr/>\n          <p ng-bind-html="chart.description() | to_trusted" class="light"></p>\n          <p data-ng-show="!chart.description()" class="light">No description given</p>\n        </div>\n      </div>\n      <div class="col-lg-9 col-md-9">\n        <div group="" every="3" watch="charts" class="row">\n          <div ng-repeat="c in charts track by $index" class="col-lg-4 col-md-4">\n            <div ng-class="{selected: c == chart}" ng-click="selectChart(c)" class="layout">\n              <div ng-style="{\'background-image\':\'url(bower_components/raw/\' + c.thumbnail() + \')\'}" class="layout-thumb"></div>\n              <p class="layout-inner"><span class="layout-title">{{c.title()}}</span><i data-ng-show="c==chart" class="fa fa-check pull-right"></i></p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </section>\n  <section data-ng-show="!error &amp;&amp; data.length" class="dark">\n    <div id="mapping" class="row-fluid">\n      <div>\n        <h3>Map your dimensions<a data-toggle="tooltip" data-title="Clear all" ng-click="model.clear()" class="pull-right light"><i class="fa fa-trash-o"></i></a><span class="clearfix"></span></h3>\n      </div>\n      <div class="row">\n        <div class="col-lg-3 col-md-3">\n          <div draggable="">\n            <ul class="list-unstyled dimensions-list">\n              <li data-dimension="{{dimension}}" ng-repeat="dimension in metadata track by $index" class="dimension"><span class="dimension-key">{{ dimension.key }}</span><span class="dimension-type">{{dimension.type}}</span><span class="dimension-icon pull-right"><i class="fa fa-bars"></i></span></li>\n            </ul>\n          </div>\n        </div>\n        <div class="col-lg-9 col-md-9">\n          <div class="sticky">\n            <div group="" every="3" watch="model" class="row">\n              <div ng-repeat="dimension in model.dimensions().values() track by $index" ng-init="open=false" class="col-lg-4 col-md-4 dimensions-wrapper">\n                <div class="dimensions-model">\n                  <div class="dimension-multiple"><i data-toggle="tooltip" data-title="Single dimension" data-ng-show="!dimension.multiple()" class="fa fa-tag"></i><i data-toggle="tooltip" data-title="Multiple dimension" data-ng-show="dimension.multiple()" class="fa fa-tags"></i></div><a data-toggle="tooltip" data-title="Show description" ng-click="open = !open" ng-show="dimension.description()" class="dimension-info">\n                    <!-- <i class="fa fa-info dimension-info-toggle"></i>--></a>\n                  <p class="dimension-title">{{dimension.title()}}</p>\n                  <ul sortable="" title="dimension.title()" value="dimension.value" multiple="dimension.multiple()" types="dimension.types()" class="dimensions-container list-unstyled"></ul>\n                  <!-- <div class="dimension-description" ng-class="{open: open}">{{dimension.description()}}</div>-->\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </section>\n  <section data-ng-show="!error &amp;&amp; data.length">\n    <h3 id="options">Customize your Visualization</h3>\n    <div class="row">\n      <div class="col-lg-3">\n        <ul class="list-unstyled">\n          <li ng-repeat="option in chart.options() track by $index" chart-option="">\n            <p class="option-title">{{option.title()}}<a data-ng-show="option.fitToWidth()" data-toggle="tooltip" data-title="Fit to width" class="option-fit pull-right"><i class="fa fa-expand"></i></a></p>\n            <div ng-switch="" on="option.type()">\n              <input type="number" min="0" ng-model="option.value" ng-switch-when="number" class="form-control"/>\n              <div ng-switch-when="checkbox">\n                <label class="checkbox">\n                  <input type="checkbox" ng-model="option.value"/>\n                </label>\n              </div>\n              <div colors="option.value" ng-switch-when="color"></div>\n              <button type="button" ng-model="option.value" ng-change="$apply()" ng-options="opt for opt in option.values()" bs-select="" ng-switch-when="list" class="btn btn-default">Action<span class="caret"></span></button>\n              <input type="text" min="0" ng-model="option.value" ng-switch-default="ng-switch-default" class="form-control"/>\n            </div>\n          </li>\n        </ul>\n      </div>\n      <div class="col-lg-9">\n        <div class="chart-resize">\n          <div id="chart" ng-show="!isEmpty()" chart=""></div>\n          <p ng-show="isEmpty()" class="light"><i class="fa fa-hand-o-up breath-right"></i> Map your dimensions in the panels above to build the visualization</p>\n        </div>\n      </div>\n    </div>\n  </section>\n  <section ng-show="!isEmpty()" style="padding-bottom:50px" class="dark">\n    <div id="export" class="row">\n      <div class="col-lg-3">\n        <h3><i class="fa fa-arrow-circle-o-down breath-right"></i>Download</h3>\n        <downloader></downloader>\n      </div>\n      <div class="col-lg-9">\n        <h3 id="data"><i class="fa fa-code breath-right"></i>Embed Code</h3>\n        <coder></coder>\n        <p class="light">Copy the code above into your HTML to embed the visualization<a id="copy-button" copy-button="" data-clipboard-target="source" data-container="body" class="pull-right"><i class="fa fa-clipboard"></i></a></p>\n      </div>\n    </div>\n  </section>\n</div>')}])}();