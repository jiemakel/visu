(function(){"use strict";angular.module("app",["http-auth-interceptor","ui.router","ngStorage","ngRoute","ngAnimate","ngSanitize","raw.services","raw.directives","raw.controllers","mgcrea.ngStrap","infinite-scroll","ui","colorpicker.module"]).config(["$stateProvider","$urlRouterProvider",function(n,t){return n.state("home",{url:"/?sparqlEndpoint&query&outputType",templateUrl:"partials/main.html",controller:"MainCtrl"}),t.otherwise("/")}]).run(["$rootScope","$http","authService",function(n,t,e){return n.setAuth=function(){return n.authOpen=!1,t.defaults.headers.common.Authorization="Basic "+btoa(n.username+":"+n.password),e.loginConfirmed()},n.dismissAuth=function(){return n.authOpen=!1,e.loginCancelled({status:401},"Authentication required")},n.$on("event:auth-loginRequired",function(){return n.authOpen=!0})}])}).call(this),function(){angular.module("app").filter("to_trusted",["$sce",function(n){return function(t){return n.trustAsHtml(t)}}]),angular.module("app").run(["$compile","$rootScope",function(n,t){YASR.plugins.raw=function(e){return{yasr:e,name:"RAW",hideFromSelection:!1,priority:1,scope:void 0,settings:void 0,setPersistentSettings:function(n){this.settings=n},getPersistentSettings:function(){var n,t,e,s,i,a,o,l,r;if(this.scope){for(n=-1,t=0,s=(e=this.scope.charts).length;s>t;++t)i=t,a=e[t],this.scope.chart===a&&(n=i);this.settings={chartIndex:n,dimensions:{},options:[]};for(o in e=this.scope.model.dimensions()._)l=e[o],this.settings.dimensions[o]=l();if(-1!==n)for(t=0,s=(e=this.scope.charts[n].options()).length;s>t;++t)r=e[t],this.settings.options.push("function"!=typeof r()?r():void 0);return this.settings}},canHandleResults:function(n){return n.results&&n.results.getVariables&&n.results.getVariables()},draw:function(){var s;s=t.$new(),s.lastError=0,s.text=e.plugins.table.getDownloadInfo().getContent().replace(/^ /gm,"").replace(/ ,$/gm,"").replace(/ , /g,","),e.resultsContainer.html(n('<div ng-controller="RawCtrl"><div ng-include=\'"partials/raw.html"\'></div></div>')(s)),s.$digest(),this.scope=s.$$childHead,this.scope.parse(s.text),null!=this.settings&&(-1!==this.settings.chartIndex&&(this.scope.chart=this.scope.charts[this.settings.chartIndex],this.scope.model.clear(),this.scope.model=this.scope.chart.model()),this.scope.$digest(),this.settings=void 0),window.ts=this.scope}}}}])}.call(this),function(){function n(n,t){for(var e=-1,s=t.length>>>0;++e<s;)if(n===t[e])return!0;return!1}YASR.plugins.gmaps=function(t){return{yasr:t,name:"Google Maps",hideFromSelection:!1,priority:2,canHandleResults:function(t){return t.results&&t.results.getVariables&&t.results.getVariables()&&n("lat",t.results.getVariables())&&n("lon",t.results.getVariables())},draw:function(){function n(n){google.maps.event.addListener(n.marker,"click",function(){var t,e,i,o;t="<table>";for(e in i=n.res)o=i[e],t+="<tr><th>"+e+"</th><td>"+o.value+"</td></tr>";t+="</table>",a.setContent(t),a.open(s,n.marker)})}var e,s,i,a,o,l,r,c,p;for(t.resultsContainer.html('<div id="gmap"></div>'),e={mapTypeId:google.maps.MapTypeId.SATELLITE},s=new google.maps.Map(t.resultsContainer.find("div")[0],e),i=new google.maps.LatLngBounds,a=new google.maps.InfoWindow,o=0,r=(l=t.results.getBindings()).length;r>o;++o)c=l[o],p=new google.maps.LatLng(c.lat.value,c.lon.value),i.extend(p),n.call(this,{res:c,marker:new google.maps.Marker({position:p,map:s,title:null!=c.name?c.name.value:c.lat.value+","+c.lon.value})});s.fitBounds(i),s.panToBounds(i)}}}}.call(this),function(){function n(n,t){for(var e=-1,s=t.length>>>0;++e<s;)if(n===t[e])return!0;return!1}YASR.plugins.kml=function(t){return{yasr:t,name:"KML",hideFromSelection:!1,priority:3,canHandleResults:function(t){return t.results&&t.results.getVariables&&t.results.getVariables()&&n("coordinates",t.results.getVariables())},draw:function(){var n,e,s;n=t.yasqe.getOption("sparql").endpoint,e=t.yasqe.getValue(),s="http://demo.seco.tkk.fi/sparql2kml/?endpoint="+encodeURIComponent(n)+"&query="+encodeURIComponent(e),t.resultsContainer.html('<button id="kml-copy" class="yasr_btn" style="float:right;position:relative; top:-30px;margin-bottom:-30px">Copy</button><div>URL for KML file: <a href="" id="kml-url"></a> (<a id="kml-e4d" href="" target="_blank">in Europeana 4D</a>)</div>'),$("#kml-url").text(s).attr("href",s),$("#kml-e4d").attr("href","http://www.informatik.uni-leipzig.de:8080/e4D/?source1=1&kml1="+encodeURIComponent(s)),$("#kml-copy").click(function(){window.prompt("Copy to clipboard with Ctrl/Cmd-C",s)}),$.ajax("https://www.googleapis.com/urlshortener/v1/url?key=AIzaSyDtS96pmj2IeRdw81zobVDpCfs0rFphHvc",{data:JSON.stringify({longUrl:s}),contentType:"application/json",type:"POST"}).success(function(n){s=n.id,$("#kml-url").text(s).attr("href",s),$("#kml-e4d").attr("href","http://www.informatik.uni-leipzig.de:8080/e4D/?source1=1&kml1="+encodeURIComponent(s))})}}}}.call(this),function(){angular.module("app").run(["$compile","$rootScope",function(n,t){YASR.plugins.grouped=function(e){return{yasr:e,name:"Grouped",hideFromSelection:!1,priority:1,scope:void 0,settings:void 0,setPersistentSettings:function(n){this.settings=n,this.scope&&(this.scope.selectedGrouping=this.settings.selectedGrouping)},getPersistentSettings:function(){return this.scope?(this.settings||(this.settings={})).selectedGrouping=this.scope.selectedGrouping:void 0},canHandleResults:function(n){var t;return null!=(t=n.results)&&"function"==typeof t.getVariables?t.getVariables():void 0},draw:function(){var s,i,a,o;this.scope=t.$new(),s=this.scope,s.scroll=function(){s.visible<s.groups.length&&(s.visible+=30,s.visibleGroups=s.groups.slice(0,s.visible))},s.collapseAll=function(){var n,t,e,i;for(n=0,e=(t=s.groups).length;e>n;++n)i=t[n],i.open=!1},s.expandAll=function(){var n,t,e,i;for(n=0,e=(t=s.groups).length;e>n;++n)i=t[n],i.open=!0},i=function(){s.sortByName?s.groups.sort(function(n,t){return n.name<t.name?-1:1}):s.groups.sort(function(n,t){return n.bindings.length<t.bindings.length?1:-1}),s.visibleGroups=s.groups.slice(0,s.visible)},a=function(){var n,t,a,o,l,r,c,p,d;for(n={},t={},s.vars=e.results.getVariables().slice(0),s.vars.splice(s.vars.indexOf(s.selectedGrouping),1),a=0,l=(o=e.results.getBindings()).length;l>a;++a)r=o[a],n[r[s.selectedGrouping].value]=!0,(t[c=r[s.selectedGrouping].value]||(t[c]=[])).push(r);p=[];for(d in n)p.push({open:!1,name:d,bindings:t[d]});s.groups=p,s.visible=30,i()},this.scope.availableGroupings=e.results.getVariables(),this.scope.selectedGrouping=this.scope.availableGroupings[0],null!=(null!=(o=this.settings)?o.selectedGrouping:void 0)&&(this.scope.selectedGrouping=this.settings.selectedGrouping),this.scope.$watch("sortByName",function(){s.groups&&i()}),this.scope.$watch("selectedGrouping",function(n){return a(n)}),e.resultsContainer.html(n("<div ng-include=\"'partials/grouped.html'\"></div>")(this.scope)),this.scope.$digest()}}}}])}.call(this),function(){angular.module("app").controller("MainCtrl",["$window","$location","$http","$scope","$localStorage","$state","$stateParams","$q",function(n,t,e,s,i,a,o,l){var r,c,p,d,u,g;null!=o.sparqlEndpoint&&(i.sparqlEndpoint=o.sparqlEndpoint),null!=i.sparqlEndpoint&&(s.sparqlEndpoint=i.sparqlEndpoint),s.shareLink=function(){var i,a,o,l;t.search("sparqlEndpoint",s.sparqlEndpoint),t.search("query",r.getValue()),t.search("outputType",p.options.output);for(i in a=p.plugins)o=a[i],null!=o.getPersistentSettings&&t.search(i,JSON.stringify(o.getPersistentSettings()));l=t.absUrl(),s.shareLinkLoading=!0,e.post("https://www.googleapis.com/urlshortener/v1/url?key=AIzaSyDtS96pmj2IeRdw81zobVDpCfs0rFphHvc",{longUrl:l}).then(function(t){s.shareLinkLoading=!1,n.prompt("Copy to clipboard with Ctrl/Cmd-C",t.data.id)},function(){s.shareLinkLoading=!1,n.alert("URL updated, copy it from the browser address bar")})},r=YASQE(document.getElementById("yasqe"),{createShareLink:!1,sparql:{showQueryButton:!0,endpoint:s.sparqlEndpoint,query:"",callbacks:{beforeSend:function(n,t){e.defaults.headers.common.Authorization&&n.setRequestHeader("Authorization",e.defaults.headers.common.Authorization)}}}}),null!=o.query&&r.setValue(o.query),s.sparqlEndpointInputValid=!0,c=void 0,s.$watch("sparqlEndpoint",function(n,t){null!=n&&(null!=c&&c.resolve(),c=l.defer(),e({method:"GET",url:n,params:{query:"ASK {}"},headers:{Accept:"application/sparql-results+json"},timeout:c.promise}).success(function(n){s.sparqlEndpointInputValid=null!=n["boolean"]}).error(function(){s.sparqlEndpointInputValid=!1})),n!==t&&(i.sparqlEndpoint=n,r.getOption("sparql").endpoint=n)}),p=YASR(document.getElementById("yasr"),{outputPlugins:["table","grouped","error","boolean","rawResponse","pivot","gchart","raw","gmaps","kml"],persistency:{outputSelector:o.outputType?!1:"visu",results:!1},getUsedPrefixes:r.getPrefixesFromQuery}),null!=o.outputType&&(p.options.output=o.outputType,p.header.find("button.selected").removeClass("selected"),p.header.find("button.select_"+o.outputType).addClass("selected")),null!=t.search().chartConfig&&(t.search("gchart",JSON.stringify({chartConfig:JSON.parse(t.search().chartConfig),motionChartState:t.search().motionChartState?t.search().motionChartState:void 0})),t.search("chartConfig",void 0),t.search("motionChartState",void 0));for(d in u=p.plugins)g=u[d],null!=g.setPersistentSettings&&t.search()[d]&&g.setPersistentSettings(JSON.parse(t.search()[d]));p.yasqe=r,p.options.persistency.outputSelector="visu",r.options.sparql.handlers.success=function(n,t,e){return p.setResponse({response:n,contentType:e.getResponseHeader("Content-Type")})},r.options.sparql.handlers.error=function(n,t,e){var s;return s=t+" (response status code "+n.status+")",e&&e.length&&(s+=": "+e),p.setResponse({exception:s})},null!=o.sparqlEndpoint&&null!=o.query&&r.query()}])}.call(this),function(n){try{n=angular.module("app")}catch(t){n=angular.module("app",[])}n.run(["$templateCache",function(n){n.put("partials/colors.html",'\n<script type="text/ng-template" id="templates/colors.html">\n  <button type="button" ng-model="colorScale" ng-change="setScale()" ng-options="scale.type for scale in scales" bs-select="" class="btn btn-default">Action<span class="caret"></span></button>\n  <div class="colors-table">\n    <div ng-show="colors.length">\n      <input ng-model="searchColor" type="text" placeholder="Search..." class="search-color form-control input-sm"/><i data-ng-show="searchColor" ng-click="searchColor=\'\'" class="fa fa-times-circle search-clear"></i>\n    </div>\n    <table class="table table-striped">\n      <tbody>\n        <tr ng-repeat="color in colors | filter:{\'key\':searchColor} track by $index">\n          <td>\n            <p class="light small sample-name">{{color.key}}</p>\n          </td>\n          <td class="sample">\n            <input type="text" colorpicker="hex" data-color="#ff0" data-ng-style="{\'background-color\' : color.value, \'color\' : foreground(color.value)}" ng-model="color.value" ng-change="setColor(color.key,color.value)" class="sample-color form-control"/>\n            <div class="clearfix"></div>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n  </div>\n</script>')}])}(),function(n){try{n=angular.module("app")}catch(t){n=angular.module("app",[])}n.run(["$templateCache",function(n){n.put("partials/dimensions.html",'\n<script type="text/ng-template" id="templates/dimensions.html">\n  <ul class="list-unstyled dimensions-list">{{metadata}}\n    <li data-index="{{$index}}" data-dimension="{{dimension}}" ng-repeat="dimension in metadata" class="dimension">{{ dimension.key }}<span class="dimension-type">{{dimension.type}}</span><span class="dimension-icon pull-right"><i class="fa fa-bars"></i></span></li>\n  </ul>\n</script>')}])}(),function(n){try{n=angular.module("app")}catch(t){n=angular.module("app",[])}n.run(["$templateCache",function(n){n.put("partials/grouped.html",'\n<div style="margin-top:1rem"></div>\n<div class="container">\n  <form class="form-inline">\n    <div class="form-group">\n      <label>Group by:</label>\n      <select ng-model="$parent.selectedGrouping" ng-options="group for group in availableGroupings" class="form-control"></select>\n    </div>\n    <button ng-click="expandAll()" class="btn btn-sm"><span class="glyphicon glyphicon-plus"></span></button>\n    <button ng-click="collapseAll()" class="btn btn-sm"><span class="glyphicon glyphicon-minus"></span></button>\n    <button ng-click="$parent.sortByName=!$parent.sortByName" class="btn btn-sm"><span class="glyphicon glyphicon-sort"></span></button>\n  </form>\n  <ul infinite-scroll="scroll()" infinite-scroll-distance="2">\n    <li ng-repeat="group in visibleGroups"><a href="" ng-click="group.open=!group.open">{{group.name}} ({{group.bindings.length}})</a>\n      <table ng-if="group.open" class="table table-striped table-hover table-bordered">\n        <tr>\n          <th ng-repeat="var in vars">{{var}}</th>\n        </tr>\n        <tr ng-repeat="binding in group.bindings">\n          <td ng-repeat="var in vars">{{binding[var].value}}</td>\n        </tr>\n      </table>\n    </li>\n  </ul>\n</div>')}])}(),function(n){try{n=angular.module("app")}catch(t){n=angular.module("app",[])}n.run(["$templateCache",function(n){n.put("partials/main.html",'\n<div class="ui page grid">\n  <div class="column">\n    <h1 class="ui header center aligned">(Visual) SPARQL query tool</h1>\n    <div id="shareicondiv"><i id="shareicon" ng-click="shareLink()" ng-class="shareLinkLoading ? \'loading\' : \'share\'" class="icon"></i></div>\n    <div class="ui form">\n      <div ng-class="{ \'error\': !sparqlEndpointInputValid }" class="field">\n        <label>SPARQL endpoint</label>\n        <input ng-model="sparqlEndpoint" type="text"/>\n      </div>\n      <div id="yasqe"></div>\n    </div>\n    <div id="yasr"></div>\n    <div><i class="help circle icon"></i>To use the map view, the data needs to have the variables <span class="nobr">?lat</span> and <span class="nobr">?lon</span>. In addition, <span class="nobr">?name</span> can be used to give a label to the place. To use the KML view on the other hand, the data needs a single <span class="nobr">?coordinates</span> variable with the latitude and longitude as a single comma-separated value. If you use the KML output in <a href="http://labs.europeana.eu/apps/europeana4d">Europeana4D</a>, you should probably also use at least <span class="nobr">?name</span> to give names to entities, <span class="nobr">?address</span> for place names to group by, and <span class="nobr">?when</span> to add timestamps.</div>\n  </div>\n</div>')}])}(),function(n){try{n=angular.module("app")}catch(t){n=angular.module("app",[])}n.run(["$templateCache",function(n){n.put("partials/raw.html",'\n<div>\n  <script type="text/ng-template" id="templates/colors.html">\n    <button type="button" ng-model="colorScale" ng-change="setScale()" ng-options="scale.type for scale in scales" bs-select="" class="btn btn-default">Action<span class="caret"></span></button>\n    <div class="colors-table">\n      <div ng-show="colors.length">\n        <input ng-model="searchColor" type="text" placeholder="Search..." class="search-color form-control input-sm"/><i data-ng-show="searchColor" ng-click="searchColor=\'\'" class="fa fa-times-circle search-clear"></i>\n      </div>\n      <table class="table table-striped">\n        <tbody>\n          <tr ng-repeat="color in colors | filter:{\'key\':searchColor} track by $index">\n            <td>\n              <p class="light small sample-name">{{color.key}}</p>\n            </td>\n            <td class="sample">\n              <input type="text" colorpicker="hex" data-color="#ff0" data-ng-style="{\'background-color\' : color.value, \'color\' : foreground(color.value)}" ng-model="color.value" ng-change="setColor(color.key,color.value)" class="sample-color form-control"/>\n              <div class="clearfix"></div>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </script>\n  <script type="text/ng-template" id="templates/dimensions.html">\n    <ul class="list-unstyled dimensions-list">{{metadata}}\n      <li data-index="{{$index}}" data-dimension="{{dimension}}" ng-repeat="dimension in metadata" class="dimension">{{ dimension.key }}<span class="dimension-type">{{dimension.type}}</span><span class="dimension-icon pull-right"><i class="fa fa-bars"></i></span></li>\n    </ul>\n  </script>\n  <section data-ng-show="!error &amp;&amp; data.length">\n    <h3 id="layout">Choose a Chart</h3>\n    <div class="row">\n      <div class="col-lg-3 col-md-3">\n        <div class="chart-description">\n          <h4>{{chart.title()}}</h4>\n          <hr/>\n          <p ng-bind-html="chart.description() | to_trusted" class="light"></p>\n          <p data-ng-show="!chart.description()" class="light">No description given</p>\n        </div>\n      </div>\n      <div class="col-lg-9 col-md-9">\n        <div group="" every="3" watch="charts" class="row">\n          <div ng-repeat="c in charts track by $index" class="col-lg-4 col-md-4">\n            <div ng-class="{selected: c == chart}" ng-click="selectChart(c)" class="layout">\n              <div ng-style="{\'background-image\':\'url(bower_components/raw/\' + c.thumbnail() + \')\'}" class="layout-thumb"></div>\n              <p class="layout-inner"><span class="layout-title">{{c.title()}}</span><i data-ng-show="c==chart" class="fa fa-check pull-right"></i></p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </section>\n  <section data-ng-show="!error &amp;&amp; data.length" class="dark">\n    <div id="mapping" class="row-fluid">\n      <div>\n        <h3>Map your dimensions<a data-toggle="tooltip" data-title="Clear all" ng-click="model.clear()" class="pull-right light"><i class="fa fa-trash-o"></i></a><span class="clearfix"></span></h3>\n      </div>\n      <div class="row">\n        <div class="col-lg-3 col-md-3">\n          <div draggable="">\n            <ul class="list-unstyled dimensions-list">\n              <li data-dimension="{{dimension}}" ng-repeat="dimension in metadata track by $index" class="dimension"><span class="dimension-key">{{ dimension.key }}</span><span class="dimension-type">{{dimension.type}}</span><span class="dimension-icon pull-right"><i class="fa fa-bars"></i></span></li>\n            </ul>\n          </div>\n        </div>\n        <div class="col-lg-9 col-md-9">\n          <div class="sticky">\n            <div group="" every="3" watch="model" class="row">\n              <div ng-repeat="dimension in model.dimensions().values() track by $index" ng-init="open=false" class="col-lg-4 col-md-4 dimensions-wrapper">\n                <div class="dimensions-model">\n                  <div class="dimension-multiple"><i data-toggle="tooltip" data-title="Single dimension" data-ng-show="!dimension.multiple()" class="fa fa-tag"></i><i data-toggle="tooltip" data-title="Multiple dimension" data-ng-show="dimension.multiple()" class="fa fa-tags"></i></div><a data-toggle="tooltip" data-title="Show description" ng-click="open = !open" ng-show="dimension.description()" class="dimension-info">\n                    <!-- <i class="fa fa-info dimension-info-toggle"></i>--></a>\n                  <p class="dimension-title">{{dimension.title()}}</p>\n                  <ul sortable="" title="dimension.title()" value="dimension.value" multiple="dimension.multiple()" types="dimension.types()" class="dimensions-container list-unstyled"></ul>\n                  <!-- <div class="dimension-description" ng-class="{open: open}">{{dimension.description()}}</div>-->\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </section>\n  <section data-ng-show="!error &amp;&amp; data.length">\n    <h3 id="options">Customize your Visualization</h3>\n    <div class="row">\n      <div class="col-lg-3">\n        <ul class="list-unstyled">\n          <li ng-repeat="option in chart.options() track by $index" chart-option="">\n            <p class="option-title">{{option.title()}}<a data-ng-show="option.fitToWidth()" data-toggle="tooltip" data-title="Fit to width" class="option-fit pull-right"><i class="fa fa-expand"></i></a></p>\n            <div ng-switch="" on="option.type()">\n              <input type="number" min="0" ng-model="option.value" ng-switch-when="number" class="form-control"/>\n              <div ng-switch-when="checkbox">\n                <label class="checkbox">\n                  <input type="checkbox" ng-model="option.value"/>\n                </label>\n              </div>\n              <div colors="option.value" ng-switch-when="color"></div>\n              <button type="button" ng-model="option.value" ng-change="$apply()" ng-options="opt for opt in option.values()" bs-select="" ng-switch-when="list" class="btn btn-default">Action<span class="caret"></span></button>\n              <input type="text" min="0" ng-model="option.value" ng-switch-default="ng-switch-default" class="form-control"/>\n            </div>\n          </li>\n        </ul>\n      </div>\n      <div class="col-lg-9">\n        <div class="chart-resize">\n          <div id="chart" ng-show="!isEmpty()" chart=""></div>\n          <p ng-show="isEmpty()" class="light"><i class="fa fa-hand-o-up breath-right"></i> Map your dimensions in the panels above to build the visualization</p>\n        </div>\n      </div>\n    </div>\n  </section>\n  <section ng-show="!isEmpty()" style="padding-bottom:50px" class="dark">\n    <div id="export" class="row">\n      <div class="col-lg-3">\n        <h3><i class="fa fa-arrow-circle-o-down breath-right"></i>Download</h3>\n        <downloader></downloader>\n      </div>\n      <div class="col-lg-9">\n        <h3 id="data"><i class="fa fa-code breath-right"></i>Embed Code</h3>\n        <coder></coder>\n        <p class="light">Copy the code above into your HTML to embed the visualization<a id="copy-button" copy-button="" data-clipboard-target="source" data-container="body" class="pull-right"><i class="fa fa-clipboard"></i></a></p>\n      </div>\n    </div>\n  </section>\n</div>')}])}();