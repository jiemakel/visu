(function(){"use strict";YASR.plugins.gchart=function(t,e,a){var n,o,r,i;return i=t.container.closest("[id]").attr("id"),null==t.options.gchart&&(t.options.gchart={}),null==t.options.gchart.motionChartState&&(t.options.gchart.motionChartState=localStorage.getItem(i+"_motionChartState")),null==t.options.gchart.chartConfig&&(t.options.gchart.chartConfig=localStorage.getItem(i+"_chartConfig")),r=function(t){if(null==t.type||"typed-literal"!==t.type&&"literal"!==t.type)return"string";switch(t.datatype){case"http://www.w3.org/2001/XMLSchema#float":case"http://www.w3.org/2001/XMLSchema#decimal":case"http://www.w3.org/2001/XMLSchema#int":case"http://www.w3.org/2001/XMLSchema#integer":case"http://www.w3.org/2001/XMLSchema#long":case"http://www.w3.org/2001/XMLSchema#gYearMonth":case"http://www.w3.org/2001/XMLSchema#gYear":case"http://www.w3.org/2001/XMLSchema#gMonthDay":case"http://www.w3.org/2001/XMLSchema#gDay":case"http://www.w3.org/2001/XMLSchema#gMonth":return"number";case"http://www.w3.org/2001/XMLSchema#date":return"date";case"http://www.w3.org/2001/XMLSchema#dateTime":return"datetime";case"http://www.w3.org/2001/XMLSchema#time":return"timeofday";default:return"string"}},n=function(t){if(null==t)return null;if(null==t.type||"typed-literal"!==t.type&&"literal"!==t.type)return t.value;switch(t.datatype){case"http://www.w3.org/2001/XMLSchema#float":case"http://www.w3.org/2001/XMLSchema#decimal":case"http://www.w3.org/2001/XMLSchema#int":case"http://www.w3.org/2001/XMLSchema#integer":case"http://www.w3.org/2001/XMLSchema#long":case"http://www.w3.org/2001/XMLSchema#gYearMonth":case"http://www.w3.org/2001/XMLSchema#gYear":case"http://www.w3.org/2001/XMLSchema#gMonthDay":case"http://www.w3.org/2001/XMLSchema#gDay":case"http://www.w3.org/2001/XMLSchema#gMonth":return Number(t.value);case"http://www.w3.org/2001/XMLSchema#date":case"http://www.w3.org/2001/XMLSchema#dateTime":case"http://www.w3.org/2001/XMLSchema#time":return new Date(t.value);default:return t.value}},o=new google.visualization.ChartEditor,google.visualization.events.addListener(o,"ok",function(){var e,a;return e=o.getChartWrapper(),"MotionChart"===e.getChartType()&&(t.options.gchart.motionChartState=e.n,localStorage.setItem(i+"_motionChartState",t.options.gchart.motionChartState),e.setOption("state",t.options.gchart.motionChartState),e.setOption("width",800),e.setOption("height",500),google.visualization.events.addListener(e,"ready",function(){var a;return a=e.getChart(),google.visualization.events.addListener(a,"statechange",function(){return t.options.gchart.motionChartState=a.getState(),localStorage.setItem(i+"_motionChartState",t.options.gchart.motionChartState)})})),a=e.getDataTable(),e.setDataTable(null),t.options.gchart.chartConfig=e.toJSON(),localStorage.setItem(i+"_chartConfig",t.options.gchart.chartConfig),e.setDataTable(a),e.draw()}),{options:a,container:$('<div><div id="chart"></div></div>'),parent:e,yasr:t,name:"Google Chart",hideFromSelection:!1,priority:5,editor:o,canHandleResults:function(t){var e,a;return(null!=(e=t.results)&&null!=(a=e.getVariables())?a.length:void 0)>0},draw:function(){var a,s,l,c,p,h,u,g,d,w,m,S,v,f,y,C;for(e.html('<button id="typeeditor" class="yasr_btn" style="float:right;position:relative; top:-30px;margin-bottom:-30px">Type</button><div id="chart"></div>'),$("#typeeditor").click(function(){return o.openDialog(u)}),s=new google.visualization.DataTable,l=t.results.getAsJson(),f=l.head.vars,g=0,m=f.length;m>g;g++)h=f[g],p=r(l.results.bindings[0][h]),s.addColumn(p,h);for(y=l.results.bindings,d=0,S=y.length;S>d;d++){for(a=y[d],c=[],C=l.head.vars,w=0,v=C.length;v>w;w++)h=C[w],c.push(n(a[h]));s.addRow(c)}return t.options.gchart.chartConfig?(u=new google.visualization.ChartWrapper(t.options.gchart.chartConfig),"MotionChart"===u.getChartType()&&null!=t.options.gchart.motionChartState&&(u.setOption("state",t.options.gchart.motionChartState),google.visualization.events.addListener(u,"ready",function(){var e;return e=u.getChart(),google.visualization.events.addListener(e,"statechange",function(){return t.options.gchart.motionChartState=e.getState(),localStorage.setItem(i+"_motionChartState",t.options.gchart.motionChartState)})})),u.setDataTable(s)):u=new google.visualization.ChartWrapper({chartType:"Table",dataTable:s,options:{title:"VISUalization"},containerId:"chart"}),u.draw()}}}}).call(this),function(){"use strict";angular.module("visu",["ui.router","ngStorage"]).config(["$stateProvider","$urlRouterProvider",function(t,e){return t.state("home",{url:"/?sparqlEndpoint&query&outputType&chartConfig&motionChartState",templateUrl:"partials/main.html",controller:"MainCtrl"}),e.otherwise("/")}])}.call(this),function(){"use strict";angular.module("visu").controller("MainCtrl",["$http","$scope","$localStorage","$state","$stateParams",function(t,e,a,n,o){var r,i,s;return null!=o.sparqlEndpoint&&(a.sparqlEndpoint=o.sparqlEndpoint),null!=a.sparqlEndpoint&&(e.sparqlEndpoint=a.sparqlEndpoint),e.shareLink=function(){return n.go(".",{sparqlEndpoint:e.sparqlEndpoint,query:r.getValue(),outputType:i.options.output,chartConfig:i.options.gchart.chartConfig,motionChartState:i.options.gchart.motionChartState})},r=YASQE(document.getElementById("yasqe"),{createShareLink:!1,sparql:{showQueryButton:!0,endpoint:e.sparqlEndpoint,query:""}}),null!=o.query&&r.setValue(o.query),e.sparqlEndpointInputValid=!0,e.$watch("sparqlEndpoint",function(n,o){return null!=n&&t({method:"GET",url:n,params:{query:"ASK {}"},headers:{Accept:"application/sparql-results+json"}}).success(function(t){return e.sparqlEndpointInputValid=null!=t.boolean}).error(function(){return e.sparqlEndpointInputValid=!1}),n!==o?(a.sparqlEndpoint=n,r.getOption("sparql").endpoint=n):void 0}),i=YASR(document.getElementById("yasr"),{persistency:{outputSelector:o.outputType?!1:"visu",results:!1},getUsedPrefixes:r.getPrefixesFromQuery,output:null!=(s=o.outputType)?s:void 0,gchart:{chartConfig:o.chartConfig,motionChartState:o.motionChartState}}),i.options.persistency.outputSelector="visu",r.options.sparql.handlers.success=function(t,e,a){return i.setResponse({response:t,contentType:a.getResponseHeader("Content-Type")})},r.options.sparql.handlers.error=function(t,e,a){var n;return n=e+" (response status code "+t.status+")",a&&a.length&&(n+=": "+a),i.setResponse({exception:n})},null!=o.sparqlEndpoint&&null!=o.query?r.query():void 0}])}.call(this),function(t){try{t=angular.module("visu")}catch(e){t=angular.module("visu",[])}t.run(["$templateCache",function(t){t.put("partials/main.html",'\n<div class="ui page grid">\n  <div class="column">\n    <h1 class="ui header center aligned">(Visual) SPARQL query tool</h1>\n    <div id="shareicondiv"><i id="shareicon" ng-click="shareLink()" class="share icon"></i></div>\n    <div class="ui form">\n      <div ng-class="{ \'error\': !sparqlEndpointInputValid }" class="field">\n        <label>SPARQL endpoint</label>\n        <input ng-model="sparqlEndpoint" type="text"/>\n      </div>\n      <div id="yasqe"></div>\n    </div>\n    <div id="yasr"></div>\n  </div>\n</div>')}])}();